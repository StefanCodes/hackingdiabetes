
<!DOCTYPE html>
<html>
  <head>
    <title>Hacking Diabetes</title>
      <script type="text/javascript" src="https://www.google.com/jsapi"></script>
      <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
      <script type="text/javascript">

        //3 6 12 24 wk
        var hours3 = "http://wotkit.sensetecnic.com/api/sensors/mike.glucose/data?before=10800000";   //3 hours
        var hours6 = "http://wotkit.sensetecnic.com/api/sensors/mike.glucose/data?before=21600000";    //6 hours
        var hours12 = "http://wotkit.sensetecnic.com/api/sensors/mike.glucose/data?before=43200000";  //12 hours
        var hours24 = "http://wotkit.sensetecnic.com/api/sensors/mike.glucose/data?before=86400000";  //24 hours

        var hours = "http://wotkit.sensetecnic.com/api/sensors/mike.glucose/data?beforeE=144"; //default time interval;



        google.load("visualization", "1", {packages:["corechart"]});
        //google.load("visualization", "1", {packages:["gauge"]});
        google.setOnLoadCallback(drawChart);
        //google.setOnLoadCallback(drawGaugeChart);

        /*

        function drawGaugeChart() {
      		var redFrom = 30;
      		var redTo = 10;
      		var yellowFrom = 8;
      		var yellowTo = 10;

    	    $.getJSON("http://wotkit.sensetecnic.com/api/sensors/mike.blood-sensor/data?beforeE=1", function(data){
            var chartData = google.visualization.arrayToDataTable([
    			    ['Label', 'Value'],
    			    ['Glucose', data[0].value]
    			  ]);

  			var options = {
  			  width: 400, height: 400,
  			  min: 0, max: 33,
  			  greenFrom: 4, greenTo: 7,
  			  redFrom: 15, redTo: 33,
  			  //yellowFrom: 10, yellowTo: 15,
  			  minorTicks: 3
  			};

  			var chart = new google.visualization.Gauge(document.getElementById('gauge_div'));
  			chart.draw(chartData, options);
          });
        }
        */




        /* Draw Chart */
        function drawChart() {
            var x = [['Date', 'Reading (mmol/L)', 'Lower Limit', 'Upper Limit']];
            
            $.getJSON(hours, function (data) {
                $.each(data, function (key, data) {
                    var node = [new Date(data.timestamp_iso), data.value, 4.5, 7.5];
                    x.push(node);
                    document.getElementById('currentValue').innerHTML = 'Current Glucose Level: ' + node[1];
                });

                var data = google.visualization.arrayToDataTable(x);

                var options = {
                    title: 'Glucose Level',

                    //Set the min and max y values
                    vAxis: {
                      viewWindow: {
                      max:20,
                      min:0
                      }
                    },
                    animation: {
                      duration: 1000,
                      easing: 'out'
                    },
                    series: {
                      0: {
                        lineWidth: 0,
                        pointSize: 2
                      }
                    },
                };

                var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                chart.draw(data, options);
            });

            setTimeout(drawChart, 2000);
        }

        function threeHours(){
          hours = hours3;
          drawChart();
        }
        function sixHours(){
          hours = hours6;
          drawChart();
        }
        function twelveHours(){
          hours = hours12;
          drawChart();
        }
        function twentyFourHours(){
          hours = hours24;
          drawChart();
        }
      </script>
  </head>
  <body>


      <button type="button" onclick="threeHours()">3h</button>
      <button type="button" onclick="sixHours()">6h</button>
      <button type="button" onclick="twelveHours()">12h</button>
      <button type="button" onclick="twentyFourHours()">24h</button>

      <p id="currentValue"></p>

      <div id="chart_div" style="width: 1300px; height: 700px;"></div>
      <!--div id="gauge_div" style="width: 500px; height: 500px;"></div-->

      

  </body>
</html>
