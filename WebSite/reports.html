
<!DOCTYPE html>
<html>
<head>
    <title>Hacking Diabetes</title>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript">
        var lowerLimit = 4.5;
        var upperLimit = 7.5;

        var webServiceBaseURL = "http://wotkit.sensetecnic.com/api/sensors/hackathon.glucose/data";

        //1 reading every 5 mins -> 12 readings per hour
        var hours3 = webServiceBaseURL + "?beforeE=36";      //3 hours
        var hours6 = webServiceBaseURL + "?beforeE=72";       //6 hours
        var hours12 = webServiceBaseURL + "?beforeE=144";    //12 hours
        var hours24 = webServiceBaseURL + "?beforeE=288";    //24 hours

        var hours = hours24; //default to 24 hours;
                
        google.load("visualization", "1", { packages: ["corechart"] });
        google.setOnLoadCallback(drawChart);
               
        /* Draw Chart */
        function drawChart() {
            var x = [['Date', 'Reading (mmol/L)', 'Lower Limit = ' + lowerLimit, 'Upper Limit = ' + upperLimit]];

            $.getJSON(hours, function (data) {
                $.each(data, function (key, data) {
                    var node = [new Date(data.timestamp_iso), Math.round(data.value * 10) / 10, lowerLimit, upperLimit];
                    x.push(node);
                    document.getElementById('currentValue').innerHTML = 'Current Glucose Level: ' + node[1];
                });

                var data = google.visualization.arrayToDataTable(x);

                var options = {
                    title: 'Glucose Level',

                    //Set the min and max y values
                    vAxis: {
                        viewWindow: {
                            max: 20,
                            min: 0
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'out'
                    },
                    series: {
                        0: {
                            lineWidth: 0,
                            pointSize: 4
                        }
                    },
                };

                var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                chart.draw(data, options);
            });

            setTimeout(drawChart, 2000);
        }

        function threeHours() {
            hours = hours3;
            drawChart();
        }
        function sixHours() {
            hours = hours6;
            drawChart();
        }
        function twelveHours() {
            hours = hours12;
            drawChart();
        }
        function twentyFourHours() {
            hours = hours24;
            drawChart();
        }
    </script>
</head>
<body>

    <button type="button" onclick="threeHours()">3h</button>
    <button type="button" onclick="sixHours()">6h</button>
    <button type="button" onclick="twelveHours()">12h</button>
    <button type="button" onclick="twentyFourHours()">24h</button>
    <p id="currentValue"></p>
    <div id="chart_div" style="width: 1300px; height: 700px;"></div>
</body>
</html>